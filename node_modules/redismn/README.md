
# Redis Exp Package Documentation

This package provides a convenient way to interact with Redis using JSON methods and method chaining. It leverages the ioredis client library to provide a more intuitive and modern API for working with Redis.

## Table of Contents
- [Initialization](#initialization)
- [Core Methods](#core-methods)
  - [jsonset](#jsonset)
  - [jsongetAll](#jsongetall)
  - [jsonget](#jsonget)
  - [jsonqueryText](#jsonquerytext)
  - [jsonquery](#jsonquery)
  - [jsonSchemaIdx](#jsonschemaidx)
  - [where](#where)
  - [whereagregater](#whereagregater)
- [Hash Operations](#hash-operations)
- [Examples](#examples)

## Initialization

To use the Redis Exp package, you need to create an instance of the `redis_exp` class:

```javascript
const redis = new redis_exp(url, port);
```

The constructor takes two required parameters:
- `url`: The URL or host of your Redis server.
- `port`: The port number where Redis is running.

## Core Methods

### jsonset
Sets a JSON object in Redis with the specified key and model name. Optionally sets a TTL (Time To Live) for the key.

#### Syntax
```javascript
async jsonset(key, jsonobj, model_name, ttl)
```

#### Parameters
- `key` (string): The key under which to store the data.
- `jsonobj` (object): The JSON object to be stored.
- `model_name` (string): The name of the Redis model/index.
- `ttl` (number, optional): Time To Live in seconds. Default: No TTL.

#### Example
```javascript
await redis.jsonset("user_1", { first_name: "John", last_name: "Doe" }, "users");
```

### jsongetAll
Retrieves all JSON data from Redis for the specified key and model name.

#### Syntax
```javascript
async jsongetAll(key, model_name)
```

#### Parameters
- `key` (string): The key under which the data is stored.
- `model_name` (string): The name of the Redis model/index.

#### Example
```javascript
const user = await redis.jsongetAll("user_1", "users");
```

### jsonget
Retrieves specific path data from a JSON object in Redis.

#### Syntax
```javascript
async jsonget(key, pathinput, model_name)
```

#### Parameters
- `key` (string): The key under which the data is stored.
- `pathinput` (string): The JSON path to retrieve. For example, `"$.first_name"`.
- `model_name` (string): The name of the Redis model/index.

#### Example
```javascript
const firstName = await redis.jsonget("user_1", "first_name", "users");
```

### jsonqueryText
Searches for text in a Redis index/model using RediSearch syntax.

#### Syntax
```javascript
async jsonqueryText(val, model_name)
```

#### Parameters
- `val` (string): The search query.
- `model_name` (string): The name of the Redis model/index.

#### Example
```javascript
const results = await redis.jsonqueryText("John", "users");
```

The following query types are supported:
```json
{
    "simpletext": "search for field where this is available with property text",
    "*": "search for all available documents in current model/index",
    "simple phrase ": "exact match",
    "texta | textb": "one of texta and textb is available",
    "texta + textb": "both of texta and textb are available",
    "@key:value": "key-value pair search",
    "%value%": "ignore typos",
    "@key:[lowerbound upperbound]": "range search for numeric values"
}
```

### jsonquery
Searches based on specific key-value pairs in a Redis index/model.

#### Syntax
```javascript
async jsonquery(key, val, model_name)
```

#### Parameters
- `key` (string): The field name to query.
- `val` (mixed): The value to search for. Can be a number or string.
- `model_name` (string): The name of the Redis model/index.

#### Example
```javascript
const results = await redis.jsonquery("age", 25, "users");
```

### jsonSchemaIdx
Creates a RediSearch index/schema with specified fields and configurations.

#### Syntax
```javascript
async jsonSchemaIdx(model_name, key_tag_arr)
```

#### Parameters
- `model_name` (string): The name of the Redis model/index.
- `key_tag_arr` (array): Array of objects specifying field configurations. Each object should have:
  - `key_name`: The name of the field.
  - `tag_type`: The type of the field (TEXT, NUMERIC, ARRAY, TAG).
  - `arr_type` (optional): Type for array fields (defaults to TAG if not specified).
  - `sortable` (boolean, optional): Whether the field should be sortable.

#### Example
```javascript
await redis.jsonSchemaIdx("users", [
    {
        key_name: "id",
        tag_type: "NUMERIC",
        sortable: true
    },
    {
        key_name: "first_name",
        tag_type: "TEXT"
    }
]);
```

### where
Creates a query builder for executing complex queries with optional TTL.

#### Syntax
```javascript
where(model_name, ttl)
```

#### Parameters
- `model_name` (string): The name of the Redis model/index.
- `ttl` (number, optional): Time To Live in seconds. Default: 120 seconds.

#### Example
```javascript
const queryBuilder = redis.where("users");
queryBuilder.jsonget("user_1", "first_name").exec();
```

### whereagregater
Creates a query builder for executing aggregate functions on Redis data.

#### Syntax
```javascript
whereagregater(model_name)
```

#### Parameters
- `model_name` (string): The name of the Redis model/index.

#### Example
```javascript
const aggQueryBuilder = redis.whereagregater("users");
aggQueryBuilder.jsonnumrange("age", 25, 30).exec();
```

## Advanced Queries

The package supports advanced query operations like filtering, sorting, grouping, and aggregations using the `whereagregater` method. You can chain these methods together to build complex queries.

### Filter Methods
- `jsonnumrange(key, min, max)`: Filters records where a numeric field falls within a range.
- `jsongte(key, value)`: Filters records where a field is greater than or equal to a value.
- `jsonlte(key, value)`: Filters records where a field is less than or equal to a value.
- `jsongt(key, value)`: Filters records where a field is greater than a value.
- `jsonlt(key, value)`: Filters records where a field is less than a value.

### Load and Sort
- `jsonload(key)`: Loads a specific field into memory for calculations.
- `jsonsort(key, order)`: Sorts records based on a specified field (ascending or descending).

### Limits and Groups
- `jsklimit(offset, number)`: Applies limits to the result set.
- `jsongroup(key)`: Groups records by a specified field.

### Accumulators
- `jsonaccumulator(key, accumulator_type)`: Applies an accumulator function (MAX, MIN, AVG, SUM, PUSH) on a specific field.

## Hash Operations

The package also includes methods for working with Redis Hashes:

### hsetSchemaIdx
Creates a RediSearch index/schema for Redis Hashes.

#### Syntax
```javascript
async hsetSchemaIdx(model_nameorcustom, key_tag_arr)
```

#### Parameters
- `model_nameorcustom` (string): The name of the model or custom prefix.
- `key_tag_arr` (array): Array of objects specifying field configurations. Similar to `jsonSchemaIdx`.

### hsetset
Sets a value in a Redis Hash.

#### Syntax
```javascript
async hsetset(key, val$jsonobj, model_nameorcustom)
```

#### Parameters
- `key` (string): The key under which to store the data.
- `val$jsonobj` (object): The JSON object to be stored.
- `model_nameorcustom` (string): The name of the model or custom prefix.

## Conclusion

This package provides a robust set of tools for interacting with Redis, leveraging both JSON and Hash structures. It supports method chaining for building complex queries and operations, making it easier to work with Redis data in Node.js applications.